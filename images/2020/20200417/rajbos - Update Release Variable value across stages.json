{"tasks":[{"environment":{},"displayName":"Update release vars","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"#region variables\n$ReleaseVariableName = 'StageVar'\n$releaseurl = ('{0}{1}/_apis/release/releases/{2}?api-version=5.0' -f $($env:SYSTEM_TEAMFOUNDATIONSERVERURI), $($env:SYSTEM_TEAMPROJECTID), $($env:RELEASE_RELEASEID)  )\n#endregion\n\n\n#region Get Release Definition\nWrite-Host \"URL: $releaseurl\"\n$Release = Invoke-RestMethod -Uri $releaseurl -Headers @{\n    Authorization = \"Bearer $env:SYSTEM_ACCESSTOKEN\"\n}\n#endregion\n\n#region Output current Release Pipeline\nWrite-Output ('Release Pipeline variables output: {0}' -f $($Release.variables | ConvertTo-Json -Depth 10))\n#endregion\n\n\n#region Update StageVar with new value\nWrite-Host \"Updating release variable with name [$(ReleaseVariableName)] with new value [$(ReleaseVariableValue)]\"\n$release.variables.$(ReleaseVariableName).value = \"$(ReleaseVariableValue)\"\n#endregion\n\n#region update release pipeline\nWrite-Output ('Updating Release Definition')\n$json = @($release) | ConvertTo-Json -Depth 99\nInvoke-RestMethod -Uri $releaseurl -Method Put -Body $json -ContentType \"application/json\" -Headers @{Authorization = \"Bearer $env:SYSTEM_ACCESSTOKEN\" }\n#endregion\n\n#region Get updated Release Definition\nWrite-Output ('Get updated Release Definition')\nWrite-Host \"URL: $releaseurl\"\n$Release = Invoke-RestMethod -Uri $releaseurl -Headers @{\n    Authorization = \"Bearer $env:SYSTEM_ACCESSTOKEN\"\n}\n#endregion\n\n#region Output Updated Release Pipeline\nWrite-Output ('Updated Release Pipeline variables output: {0}' -f $($Release.variables | ConvertTo-Json -Depth 10))\n#endregion","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""},"task":{"id":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","versionSpec":"2.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":2,"createdBy":{"displayName":"Rob Bos","id":"f8ecdddc-8f4f-6375-b6a0-fe462f71970a","uniqueName":"rajbos+AzDoReleaseVarAccrossStages@gmail.com"},"createdOn":"2019-07-29T07:32:40.960Z","modifiedBy":{"displayName":"Rob Bos","id":"f8ecdddc-8f4f-6375-b6a0-fe462f71970a","uniqueName":"rajbos+AzDoReleaseVarAccrossStages@gmail.com"},"modifiedOn":"2019-07-29T07:35:26.987Z","comment":"Updated comment","id":"27c538a9-7c6b-4632-ba1d-f959e3ce1644","name":"Update Release Variable value across stages","version":{"major":1,"minor":0,"patch":0,"isTest":false},"iconUrl":"https://cdn.vsassets.io/v/M154_20190725.3/_content/icon-meta-task.png","friendlyName":"Update Release Variable value across stages","description":"Updating Release Variable value across stages. \n\nNote 1: the value will only be visible in the next stage!\nNote 2: needs access to the OAuth token!","category":"Deploy","definitionType":"metaTask","author":"Rob Bos","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{},"name":"$env:RELEASE_RELEASEID","label":"$env:RELEASE_RELEASEID","defaultValue":"$env:RELEASE_RELEASEID","required":true,"type":"string","helpMarkDown":"Leave as is","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"$env:SYSTEM_TEAMFOUNDATIONSERVERURI","label":"$env:SYSTEM_TEAMFOUNDATIONSERVERURI","defaultValue":"$env:SYSTEM_TEAMFOUNDATIONSERVERURI","required":true,"type":"string","helpMarkDown":"Leave as is","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"$env:SYSTEM_TEAMPROJECTID","label":"$env:SYSTEM_TEAMPROJECTID","defaultValue":"$env:SYSTEM_TEAMPROJECTID","required":true,"type":"string","helpMarkDown":"Leave as is","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"$Release.variables | ConvertTo-Json -Depth 10","label":"$Release.variables | ConvertTo-Json -Depth 10","defaultValue":"$Release.variables | ConvertTo-Json -Depth 10","required":true,"type":"string","helpMarkDown":"Leave as is","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"ReleaseVariableName","label":"ReleaseVariableName","defaultValue":"$(ReleaseVariableName)","required":true,"type":"string","helpMarkDown":"The name of the variable to update","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"ReleaseVariableValue","label":"ReleaseVariableValue","defaultValue":"$(ReleaseVariableValue)","required":true,"type":"string","helpMarkDown":"The value to update the variable with","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: Update Release Variable value across stages $($env:RELEASE_RELEASEID)","preJobExecution":{},"execution":{},"postJobExecution":{}}